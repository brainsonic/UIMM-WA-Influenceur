var f=Object.defineProperty;var m=(a,t,e)=>t in a?f(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var u=(a,t,e)=>(m(a,typeof t!="symbol"?t+"":t,e),e);import"https://unpkg.com/@workadventure/scripting-api-extra@^1";const p="https://uimm-trackers-api-stg-0b60361e2cd1.herokuapp.com/api/tracker_events";class d{constructor(t,e,i,s,o){this.layer=t,this.message=e,this.category_tracker=i,this.type_tracker=s,this.name_tracker=o,this.setup()}setup(){WA.room.onEnterLayer(this.layer).subscribe(()=>{this.triggerMessage=WA.ui.displayActionMessage({message:this.message,callback:()=>{this.interact()}})}),WA.room.onLeaveLayer(this.layer).subscribe(()=>{this.triggerMessage!==void 0&&this.close()})}track(){const t={type:this.type_tracker,category:this.category_tracker,name:this.name_tracker},e={method:"POST",headers:{"Content-Type":"application/ld+json"},body:JSON.stringify(t)};fetch(p,e).then(i=>{if(!i.ok)throw console.log("Erreur tracker"),new Error("Network response was not OK");return i.json()}).then(i=>{}).catch(i=>{console.error("Error:",i)})}interact(){this.track()}close(){this.triggerMessage!==void 0&&this.triggerMessage.remove(),this.exit()}exit(){}}class g extends d{constructor(t,e,i,s,o,r,n){super(t,e,o,r,n),this.object=s,this.dialog=i,this.state=0}interact(){this.track(),this.open()}open(){this.currentState=WA.ui.openPopup(this.object,this.dialog[this.state],[{label:this.state<this.dialog.length-1?"Suivant":"Fermer",className:"primary",callback:t=>{this.next()}}]),this.finished=!1}next(){this.state++,this.currentState!==void 0&&(this.currentState.close(),this.currentState=void 0),this.state>=this.dialog.length?(this.finished=!0,this.state=0):this.open()}exit(){!this.finished&&this.currentState!==void 0&&this.currentState.close(),this.currentState=void 0,this.state=0}}class y extends g{constructor(t,e,i,s,o,r,n,h,l){super(t,e,i,o,n,h,l),this.state=0,this.dialog_condition=s,this.function_action=r,this.old_dialog=this.dialog,this.condition=!0}interact(){WA.onInit().then(()=>{this.condition=this.function_action(),this.open()}),this.track()}open(){this.condition==!1?this.dialog=this.dialog_condition:this.dialog=this.old_dialog,this.currentState=WA.ui.openPopup(this.object,this.dialog[this.state],[{label:this.state<this.dialog.length-1?"Suivant":"Fermer",className:"primary",callback:t=>{this.next()}}]),this.finished=!1}}class b extends d{constructor(e,i,s,o,r,n,h){super(e,i,r,n,h);u(this,"position","right");this.modal=s,o!==void 0&&(this.position=o)}interact(){this.track(),this.open()}open(){WA.ui.modal.openModal({title:"Yumi",src:this.modal,allow:"fullscreen; clipboard-read;",allowApi:!0,position:this.position})}exit(){WA.ui.modal.closeModal()}}class v extends b{constructor(t,e,i,s,o,r,n,h){super(t,e,i,s,r,n,h),this.function_action=o}interact(){WA.onInit().then(()=>{this.function_action()}),this.open(),this.track()}}class x extends g{constructor(t,e,i,s,o,r,n,h,l="center"){super(t,e,i,s,r,n,h),this.video=o,this.position=l}async next(){this.state++,this.currentState!==void 0&&(this.currentState.close(),this.currentState=void 0),this.state>=this.dialog.length?(this.finished=!0,this.state=0,WA.ui.modal.openModal({title:"VideoModal",src:this.video,position:this.position})):this.open()}}class _ extends y{constructor(t,e,i,s,o,r,n,h,l,c){super(t,e,i,s,o,n,h,l,c),this.video=r,this.open_modal=!1}next(){this.state++,this.currentState!==void 0&&(this.currentState.close(),this.currentState=void 0),this.state>=this.dialog.length?(this.finished=!0,this.state=0,this.open_modal=!0,WA.ui.modal.openModal({title:"VideoModal",src:this.video,position:"center"})):this.open()}exit(){!this.finished&&this.currentState!==void 0&&this.open_modal==!1&&(this.currentState.close(),WA.ui.modal.openModal({title:"VideoModal",src:this.video,position:"center"})),this.state=0,this.open_modal=!1,this.currentState=void 0}}class A extends d{constructor(t,e,i,s,o,r,n,h){super(t,e,r,n,h),this.dialog=i,this.object=s,this.item=o,this.state=0,this.alreadyHaveItem=0}interact(){WA.onInit().then(()=>{WA.player.state[this.item]==null?WA.player.state.saveVariable(this.item,!0,{public:!0,persist:!0,ttl:720*3600}):this.alreadyHaveItem=1,this.open(),this.track()})}open(){var t=this.dialog;this.dialog=this.alreadyHaveItem==0?this.dialog:["Vous possédez déjà l'objet"],this.currentState=WA.ui.openPopup(this.object,this.dialog[this.state],[{label:this.state<this.dialog.length-1?"Suivant":"Fermer",className:"primary",callback:e=>{this.next()}}]),this.alreadyHaveItem=0,this.dialog=t,this.finished=!1}next(){this.state++,this.currentState!==void 0&&this.currentState.close(),this.currentState=void 0,this.state>=this.dialog.length?(this.finished=!0,this.state=0):this.open()}exit(){!this.finished&&this.currentState!==void 0&&this.currentState.close(),this.currentState=void 0}}class I extends A{constructor(t,e,i,s,o,r,n,h,l,c){super(t,e,i,o,r,h,l,c),this.dialog_condition=s,this.condition=n,this.state=0,this.alreadyHaveItem=0}interact(){WA.onInit().then(()=>{this.condition()==!0&&(WA.player.state[this.item]==null?WA.player.state.saveVariable(this.item,!0,{public:!0,persist:!0,ttl:720*3600,scope:"world"}):this.alreadyHaveItem=1),this.open(),this.track()})}open(){var t=this.dialog;this.dialog=this.alreadyHaveItem==0?this.dialog:["Vous possédez déjà l'objet"],this.condition()==!1&&(this.dialog=this.dialog_condition),this.currentState=WA.ui.openPopup(this.object,this.dialog[this.state],[{label:this.state<this.dialog.length-1?"Suivant":"Fermer",className:"primary",callback:e=>{this.next()}}]),this.dialog=t,this.alreadyHaveItem=0,this.finished=!1}}function M(a,t,e){let i=!1;WA.room.onEnterLayer(a).subscribe(()=>{WA.onInit().then(()=>{for(var s of t)if(console.log(s),console.log("You have the access ? :",WA.player.state[s]),WA.player.state[s]==null){WA.nav.goToRoom("#ZoneStep1"),i=!0;return}}).catch(s=>{console.error("Error TELEPORT in :",a)}).then(()=>{i&&WA.ui.openPopup(e,["Zone interdit - Veuillez faire les étapes"],[{label:"Fermer",className:"primary",callback:s=>{s.close()}}])})})}function V(a,t,e,i,s=""){WA.room.onEnterLayer(a).subscribe(()=>{WA.onInit().then(()=>{e()?WA.nav.goToRoom(t):WA.ui.openPopup(i,s==""?["Vous n'avez pas les items requis pour accéder à la TP"]:s,[{label:"Fermer",className:"primary",callback:o=>{o.close()}}])})})}function j(a,t){WA.room.onEnterLayer(a).subscribe(()=>{WA.onInit().then(()=>{for(var e of t)console.log(e),(WA.player.state[e]==null||WA.player.state[e]==null)&&WA.player.state.saveVariable(e,!0,{public:!0,persist:!0,ttl:720*3600,scope:"world"})})})}function E(a){WA.player.state.saveVariable(a,!0,{public:!0,persist:!0,ttl:720*3600,scope:"world"})}function P(a,t){WA.room.onEnterLayer(a).subscribe(()=>{WA.room.showLayer(a),WA.onInit().then(()=>{WA.nav.goToRoom(t)})})}class W{constructor(t,e,i,s,o){this.layer=t,this.message=e,this.category_tracker=i,this.type_tracker=s,this.name_tracker=o,this.setup()}setup(){WA.state.saveVariable("technophobyVisible",!0),WA.room.onEnterLayer(this.layer).subscribe(()=>{this.triggerMessage=WA.ui.displayActionMessage({message:this.message,callback:()=>{this.interact()}})}),WA.room.onLeaveLayer(this.layer).subscribe(()=>{this.triggerMessage!==void 0&&this.close()})}track(){const t={type:this.type_tracker,category:this.category_tracker,name:this.name_tracker},e={method:"POST",headers:{"Content-Type":"application/ld+json"},body:JSON.stringify(t)};fetch(p,e).then(i=>{if(!i.ok)throw console.log("Erreur tracker"),new Error("Network response was not OK");return i.json()}).then(i=>{}).catch(i=>{console.error("Error:",i)})}interact(){this.track()}close(){this.triggerMessage!==void 0&&this.triggerMessage.remove(),this.exit()}exit(){}}class w extends W{constructor(t,e,i,s,o,r,n){super(t,e,o,r,n),this.layer=t,this.object=s,this.dialog=i,this.state=0}interact(){this.track(),this.open()}open(){this.currentState=WA.ui.openPopup(this.object,this.dialog[this.state],[{label:this.state<this.dialog.length-1?"Suivant":"Fermer",className:"primary",callback:t=>{this.next()}}]),this.finished=!1}next(){this.state++,this.currentState!==void 0&&(this.currentState.close(),this.currentState=void 0),this.state>=this.dialog.length?(this.finished=!0,this.state=0):this.open()}exit(){!this.finished&&this.currentState!==void 0&&this.currentState.close(),this.currentState=void 0,this.state=0}}export{g as D,I,b as M,x as P,_ as a,v as b,E as c,y as d,w as e,V as f,j as g,M as o,P as t};
